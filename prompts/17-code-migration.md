# 17 — Миграция и обновление кода

> **Аннотация:** Промпт для миграции кода между версиями, фреймворками или языками. Пошаговый план миграции с сохранением функциональности и обратной совместимости.

## Когда использовать

- Обновление фреймворка (React 17→18, Next.js 13→14)
- Миграция на новый язык (JS→TS)
- Замена библиотеки
- Переход с Legacy на Modern

---

## Промпт

```
# Роль
Ты — Senior Developer, специализирующийся на миграциях ${language}.

# Задача
Мигрируй код с ${from} на ${to}.

# Текущий код
```
${code}
```

# Контекст миграции
- Причина миграции: ${reason}
- Должна ли быть обратная совместимость: ${backwardCompatible}
- Покрытие тестами: ${testCoverage}
- Можно ли мигрировать постепенно: ${incremental}

# Предоставь

## 1. Анализ изменений
Что меняется между ${from} и ${to}:
- Breaking changes, затрагивающие этот код
- Deprecated API, которые используются
- Новые возможности, которые стоит применить

## 2. План миграции (пошаговый)
Шаг 1: [что сделать] → [какой файл] → [как проверить]
Шаг 2: ...
(Каждый шаг — рабочее состояние проекта)

## 3. Мигрированный код
Для каждого файла:
- Путь
- Полный код (не фрагменты)
- Комментарии к изменениям (что и почему)

## 4. Что проверить после миграции
- Список тестов для прогона
- Ручные проверки
- Потенциальные проблемы
```

---

## Советы

- Прикладывайте changelog новой версии
- Для крупных миграций — **Prompt Chaining**: анализ → план → миграция по файлам
- Указывайте, нужна ли обратная совместимость

## Роль в агентной системе

Миграция — критическая операция. Каждый шаг = рабочее состояние проекта.
After: обнови features.json (все затронутые фичи перепроверь).

## ⚠️ Антипаттерны

- **Build on Broken**: Каждый шаг миграции должен оставлять проект рабочим
- **Trust Everything**: E2E после каждого шага, не только в конце
- **Overloading**: Не мигрируй всё сразу — пошагово
