# 15 — Проектирование API

> **Аннотация:** Промпт для проектирования REST/GraphQL API: эндпоинты, модели, аутентификация, версионирование, документация. Создаёт полную спецификацию, готовую к реализации.

## Когда использовать

- Новый API-сервис
- Расширение существующего API
- Переход от монолита к микросервисам
- Документирование существующего API

---

## Промпт

```
# Роль
Ты — Senior API Designer. Проектируй API по принципам REST / ${apiStyle}.

# Задача
Спроектируй API для: ${servicePurpose}

# Ресурсы (сущности)
1. ${resource1}
2. ${resource2}
3. ${resource3}

# Требования
- Аутентификация: ${authMethod} (JWT / OAuth2 / API Key)
- Рейт-лимит: ${rateLimit}
- Версионирование: ${versioning} (/v1/ / Accept header)
- Формат: JSON
- Пагинация: ${pagination} (cursor / offset)

# Предоставь

## 1. Таблица эндпоинтов
| Метод | Путь | Описание | Авторизация |
|-------|------|----------|-------------|
| GET | /api/v1/users | Список пользователей | Admin |

## 2. Модели (JSON Schema)
Для каждого ресурса:
- Request body (create, update)
- Response body (single, list)
- Ошибки

## 3. Примеры запросов и ответов
```http
GET /api/v1/users?page=1&limit=20
Authorization: Bearer {token}

200 OK
{
  "data": [...],
  "meta": { "total": 100, "page": 1 }
}
```

## 4. Обработка ошибок
Стандартный формат:
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "...",
    "details": [...]
  }
}
```
Коды: 400, 401, 403, 404, 409, 422, 429, 500

## 5. Аутентификация и авторизация
Поток авторизации для каждой роли

## 6. OpenAPI/Swagger YAML (фрагмент ключевых эндпоинтов)
```

---

## Советы

- Прикладывайте существующие эндпоинты как **Few-Shot**
- Укажите стандарт ошибок и пагинации проекта

## Роль в агентной системе

**Prompt Chaining**: DB (14) → API (этот) → Implement (03) → Test (12) → Docs (16)

## ⚠️ Антипаттерны

- **Vagueness**: "Создай API" → укажи ресурсы, методы, схемы, авторизацию
- **Security Neglect**: Аутентификация, rate limiting, CORS с первого дня
- **Hallucination**: Проверяй сгенерированную OpenAPI spec на валидность

## Советы

- Указывайте роли пользователей для матрицы доступа
- Для публичных API: добавьте раздел "Developer Experience"
- Результат можно импортировать в Swagger
