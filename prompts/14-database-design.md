# 14 — Проектирование базы данных

> **Аннотация:** Промпт для проектирования схемы БД: сущности, связи, индексы, миграции. Включает нормализацию, оптимизацию запросов и примеры SQL.

## Когда использовать

- Новый проект — создание схемы с нуля
- Добавление нового модуля с новыми таблицами
- Оптимизация существующей схемы
- Миграция между СУБД

---

## Промпт

```
# Роль
Ты — Database Architect, специализирующийся на ${dbType} (PostgreSQL / MySQL / MongoDB).

# Задача
Спроектируй схему базы данных для ${application}.

# Требования
1. ${feature1}
2. ${feature2}
3. ${feature3}

# Контекст
- Ожидаемый объём: ${dataVolume}
- Частые запросы: ${frequentQueries}
- Соотношение чтения/записи: ${readWriteRatio}
- ORM: ${orm} (Prisma / SQLAlchemy / TypeORM)

# Предоставь

## 1. ER-диаграмма (текстовая)
```
[User] 1──M [Order] M──M [Product]
         1──1 [Profile]
```

## 2. Определения таблиц
Для каждой таблицы:
- Колонки с типами, NOT NULL, default
- Primary key, foreign keys
- Уникальные ограничения

## 3. Индексы
Для каждого:
- Какие колонки
- Тип (B-tree, Hash, GIN, GiST)
- Для какого запроса оптимизирует

## 4. Миграции (SQL)
CREATE TABLE / ALTER TABLE в порядке выполнения

## 5. Примеры запросов
Для основных сценариев: SELECT / JOIN / агрегации

## 6. Соображения по производительности
- Партиционирование (если нужно)
- Денормализация (если оправдана)
- Стратегия кэширования
```

---

## Советы

- Указывайте частые запросы — это определяет индексы
- Для NoSQL: опишите паттерны доступа вместо ER-диаграммы
- Прикладывайте ORM-формат, если проект использует ORM

## Роль в агентной системе

Проектирование БД — часть этапа планирования.
**Prompt Chaining**: Архитектура (13) → DB (14) → API (15) → Init (19)

## ⚠️ Антипаттерны

- **Hallucination**: ИИ может использовать синтаксис другой БД — укажи точный PostgreSQL/MySQL
- **Assumption**: Не предполагай объём данных — укажи ожидаемый рост
